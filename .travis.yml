language: node_js
node_js:
  - 7
cache:
  yarn: true
env:
  global:
  - NODE_ENV=test
services:
- mongodb
- rabbitmq
- redis-server
before_install:
- cp ./config ./api/config
- cp ./models ./api/src/models
- cp ./worker ./worker/config
- cp ./models ./api/src/models
install:
- cd ./api && npm install
- cd ../worker && npm install
- cd ../
cache:
  directories:
    - ./api/node_modules
    - ./worker/node_modules
before_script:
- sleep 10
script:
- pwd
- cd ./api && npm test
- pwd
